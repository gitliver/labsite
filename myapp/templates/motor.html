{% extends "layout.html" %}

{% block title %}Topological Data Analysis of In Vitro Motor Neuron Differentiation from mESCs{% endblock %}

<!-- CSS for this specific page -->
{% block extracss %}

<!-- qTip2 -->
<link rel="stylesheet" href="/static/jquery.qtip.custom/jquery.qtip.css">

{% endblock %}

<!-- Header -->
{% block header2 %}

<br><br><br><br><br><br>
<p class="lead" style="color: black"><b>Topological Data Analysis of <i>In Vitro</i> Motor Neuron Differentiation from mESCs</b></p>
<br>

{% endblock %}

<!-- Content -->
{% block content %}

<div class="row">

  <div class="col-md-4">

    <p style="color: black">
    The directed differentiation of murine embryonic stem cells into motor neurons enables in vitro modeling of neurodegenerative diseases and rational approaches to regenerative therapies. We differentiated murine embryonic stem cells into motor neurons and, using modifications to the CEL-Seq approach, we generated libraries from 440 single cells sampled across days two through six of differentiation<sup>1</sup>. These time points span the transition from totipotency to post-mitotic fate. Single cell RNA-Seq read counts were analyzed using topological methods. Through this webpage you can explore some of the results of this analysis.
    </p>

  </div>

  <div class="col-md-4">
    <img class="featurette-image img-responsive center-block" src="/static/img/other/mn_600.jpg" alt="image" width="300">
  </div>

</div>

<br>

<div class="row">

  <div class="col-md-4">

    <p style="color: black">
    This figure contains a topological representation of the data, colored by time point. Each node represents a set of single cells with related transcriptional programs. The same cell may appear in several nodes. Nodes that have one or more cells in common are connected through an edge. Hence, connected nodes are also transcriptionally related. The resulting graph is a topological representation, namely position and distances have no meaning, it only matters how different nodes are connected.
    </p>

  </div>

  <div class="col-md-4">
    <img class="featurette-image img-responsive center-block" src="/static/img/other/day.jpg" alt="image" width="300">
  </div>

</div>

<div class="row">

  <div class="col-md-8">

    <p style="color: black">
    Using the following form, you can color the above topological representation by expression of any gene (red: high values; blue: low values). Several statistics associated to the gene are also displayed. See [1] for more details on the experimental setting, analysis and statistics.
    </p>

    <br>

    <small>
    <sup>1</sup> <strong class="ocustom-bitter">Unsupervised Detection of Cellular Fate.</strong>
    <br>
    Abbas H. Rizvi, Pablo Camara, Elena K. Kandror, Thomas J. Roberts, Tom Maniatis, and Raul Rabadan.
    <br>
    2015 <i>In preparation</i>.<br>
    </small>

    <br>

    <!-- try Flask wtforms -->
    <!--
    <form action="" method="post" name="login">
    	{{ form.hidden_tag() }}
    
    	<p style="color: #336699">
		<b>Please enter your gene:</b><br>
    		<small>(Example: <i>Pou5f1</i> or <i>Etv5</i>)</small><br>
    		{{ form.geneid(size=20) }}<br>
    	</p>
    
    	<p><input type="submit" value="Submit"></p>
    </form>
    -->

    <p style="color: #336699">
        <b>Please enter your gene:</b><br>
    	<small>(Example: <i>Pou5f1</i> or <i>Etv5</i>)</small><br>
        <input type=text size=15 name=geneinput>
    </p>

    <!-- http://stackoverflow.com/questions/710089/how-do-i-make-an-html-link-look-like-a-button -->
    <a href=# style="font: bold 11px Arial; text-decoration: none; background-color: #EEEEEE; color: red; padding: 2px 6px 2px 6px; border-top: 1px solid #CCCCCC; border-right: 1px solid #333333; border-bottom: 1px solid #333333; border-left: 1px solid #CCCCCC;" id=getinput>submit</a>
    <br>
    <br>

    <!-- http://flask.pocoo.org/docs/0.10/patterns/jquery/ -->
    <!--
    <h4>Testing - Switch to AJAX Call</h4>
    <p>
      <input type=text size=5 name=a> + <input type=text size=5 name=b> = <span id=result>?</span>
    </p>
    <a href=# id=calculate>calculate server side</a>
    -->

  </div>

</div>

<!-- JS inserts into the following tags -->

<div class="row">

  <div class="col-md-4">
    <div style="margin-left: 50px;" id="startHidden"> 
     <span id="idgene"></span><br>
     <span id="idcell"></span><br>
     <span id="idmean"></span><br>
     <span id="idmin"></span><br>
     <span id="idmax"></span><br>
     <span id="idconn"></span><br>
     <span id="idpval"></span><br>
     <span id="idqval"></span><br>
     <span id="idcent"></span><br>
     <span id="iddisp"></span><br>
     <span id="idrna"></span><br>
     <span id="idsplice"></span><br>
     <span id="idsurf"></span><br>
     <span id="idreg"></span><br>
    </div>
  </div>

  <div class="col-md-4" id="insertImg1">
  </div>

</div>

<div class="row">
  <div class="col-md-4" id="insertImg2">
  </div>
  <div class="col-md-4" id="insertImg3">
  </div>
</div>

<div class="row">
  <div class="col-md-8" id="insertImg4">
  </div>
</div>

{% endblock %}

{% block extrajs %}

<script src="/static/jquery.qtip.custom/jquery.qtip.js"></script>
<script src="/static/js/custom.js"></script>

<script>
  $(document).ready(function() {

	// hide this to begin with
	$("#startHidden").hide();

	// html IDs to be written into
	var myIdArray = ["idgene",
		    "idcell",
		    "idmean",
		    "idmin",
		    "idmax",
		    "idconn",
		    "idpval",
		    "idqval",
		    "idcent",
		    "iddisp",
		    "idrna",
		    "idsplice",
		    "idsurf",
		    "idreg"];

	// explanation of each field
	var myTextArray = [ "The gene",
		      "The number of cells where expression of the gene is detected",
		      "Mean expression value in log_2(1+TPM) scale",
		      "Min expression value in log_2(1+TPM) scale",
		      "Max expression value in log_2(1+TPM) scale",
		      'Connectivity quantifies how "connected" the expression of the gene appears in the topological graph',
		      "Statistical significance of the connectivity. Highly significant genes are specific to particular cell populations or stages",
		      "Statistical significance (FDR) of connectivity after Benjamini-Hochberg adjustment for multiple testing",
		      "Position (in number of edges units) of the gene expression centroid with respect to the inferred root node (the most stem-like node). High (low) values correspond to genes expressed in post-mitotic (totipotent) cells",
		      "Dispersion of the centroid (in number of edges units)",
		      "Whether the gene belongs to gene ontology GO0044822, poly(A) RNA binding",
		      "Whether the gene belongs to gene ontology GO0008380, RNA splicing",
		      "Whether the protein encoded by the gene has an extracellular domain, according to InterPro database",
		      "Whether the gene belongs to gene ontology GO0006355, Regulation of transcription, DNA-templated" ];

	// add qtips to fields
	for (var i = 0; i < myIdArray.length; i++) {
		$("#" + myIdArray[i]).qtip({
		content: myTextArray[i],
		style: {classes: 'qtip-rounded qtip-bootstrap'}, 
		// position: { corner: { target: 'topLeft', tooltip: 'leftBottom' } }
		});
	}

  });
</script>

<script>

  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
  // console.log("Testing");
  // console.log($SCRIPT_ROOT);

  // simple addition following the example of Flask with Ajax and Jquery
  // http://flask.pocoo.org/docs/0.10/patterns/jquery/
  /*
  $(function() {
    $('a#calculate').bind('click', function() {
      $.getJSON($SCRIPT_ROOT + '/_add_numbers', {
        a: $('input[name="a"]').val(),
        b: $('input[name="b"]').val()
      }, function(data) {
        $("#result").text(data.result);
      });
      return false;
    });
  });
  */

  // need to sanitize input?

   /*
    docs: 
    jQuery.getJSON( url [, data ] [, success ] )
    Description: Load JSON-encoded data from the server using a GET HTTP request.
    url (Type: String) - A string containing the URL to which the request is sent.
    data (Type: PlainObject or String) -  A plain object or string that is sent to the server with the request.
    success (Type: Function( PlainObject data, String textStatus, jqXHR jqXHR ) ) - A callback function that is executed if the request succeeds.
   */

  $(function() {
    $('a#getinput').bind('click', function() {
      $.getJSON($SCRIPT_ROOT + '/_get_gene_result', {
        mygene: $('input[name="geneinput"]').val()
      }, function(data) {

	// show the fields
	$("#startHidden").show();

        // insert the data from the database into HTML tags
        $("#idgene").html('Gene: <b>' + data.Gene + '</b>')
        $("#idcell").html('Cells <b>' + data.Cells + '</b>')
        $("#idmean").html('Mean: <b>' + data.Mean + '</b>')
        $("#idmin").html('Min: <b>' + data.Min + '</b>')
        $("#idmax").html('Max: <b>' + data.Max + '</b>')
        $("#idconn").html('Connectivity: <b>' + data.Connectivity + '</b>')
        $("#idpval").html('<i>p</i>-value: <b>' + data.p_value + '</b>')
        $("#idqval").html('<i>q</i>-value (BH): <b>' + data.BH_p_value + '</b>')
        $("#idcent").html('Centroid: <b>' + data.Centroid + '</b>')
        $("#iddisp").html('Dispersion: <b>' + data.Dispersion + '</b>')
        $("#idrna").html('RNA binding: <b>' + data.RNA_binding + '</b>')
        $("#idsplice").html('Splicing Factor: <b>' + data.Splicing + '</b>')
        $("#idsurf").html('Surface Marker: <b>' + data.Surface + '</b>')
        $("#idreg").html('Regulation of Transcription: <b>' + data.Transcription + '</b>')

        // insert the images into HTML tags
	$("#insertImg1").html('<img src="' + data.img1 + '" alt="image" width="400">')
	$("#insertImg2").html('<div style="margin-left: 50px;">Zoom of progenitor region:</div><img src="' + data.img2 + '" alt="image" width="400">')
	$("#insertImg3").html('<div style="margin-left: 50px;">Zoom of post-mitotic region:</div><img src="' + data.img3 + '" alt="image" width="400">')
	$("#insertImg4").html('<div style="margin-left: 50px;">Reconstructed expression timeline:</div>' + 
	  '<img src="' + data.img4 + '" alt="image" width="800">' + 
	  '<div style="text-align: center;"><small>day</small></div>'
	)
      });
      return false;
    });
  });

</script>

{% endblock %}
